吹牛皮扑克游戏 需求规格说明书（更新版）
1. 引言
1.1 目的
本文档旨在明确“吹牛皮扑克游戏”的功能性、非功能性及界面需求，为开发团队（包括前端开发、AI算法设计及测试人员）提供清晰、完整的设计依据。游戏为单人娱乐产品，玩家与三个电脑对手进行对战，采用GODOT框架实现。

1.2 范围
本项目是一个基于GODOT引擎开发的单人扑克游戏，玩家通过鼠标操作手牌，与电脑AI进行“吹牛皮”玩法对战。主要功能包括：游戏初始化、回合控制、手牌管理、出牌与质疑、AI决策、胜负判定及界面交互。

1.3 定义与缩写
吹牛皮：一种扑克游戏，玩家可虚报所出牌的点数，其他玩家可质疑。

点数：扑克牌的等级，包括A、2、3、4、5、6、7、8、9、10、J、Q、K，以及大小王（万能牌）。

万能牌：大小王，可当作任何点数使用。

牌堆：当前轮次中所有已打出但未被质疑的牌集合，细分为累积牌区和最新出牌区。

累积牌区：当前轮次中除最新一轮出牌外的所有牌（即之前的出牌）。

最新出牌区：上一家刚打出的牌（等待被质疑或跟牌）。

弃牌区：全部跳过时，牌堆中的牌进入弃牌区，这些牌永久退出游戏，不再属于任何玩家。

出牌权：当前轮到哪位玩家行动。

AI：人工智能，控制电脑玩家的行为。

1.4 参考资料
游戏玩法描述（用户提供）
GODOT

扑克通用规则

2. 总体描述
2.1 产品视角
“吹牛皮扑克游戏”是一款休闲益智类网页游戏，玩家通过浏览器即可开始对局。游戏界面简洁明了，突出手牌区域、牌堆状态及玩家信息。电脑对手的行为具备一定智能，能根据游戏局势做出合理决策，提供适中的挑战性。

2.2 用户特征
目标用户为熟悉或希望了解“吹牛皮”玩法的扑克爱好者，年龄不限，具备基本计算机操作能力。单人游戏模式适合碎片化时间娱乐。

2.3 假设与依赖
游戏运行环境为支持HTML5、CSS3及JavaScript的现代浏览器（如Chrome、Firefox、Edge）。

无需后端服务，所有游戏逻辑均在客户端运行。

屏幕分辨率至少为1024×768，以保证界面布局正常。

2.4 设计与实现约束
使用GODOT4.5 + GD SCRIPT进行开发。

AI策略需具备可调整性，便于后续难度分级。

3. 功能需求
3.1 游戏初始化
需求编号	需求描述
FR1.1	系统应能生成一副标准的54张扑克牌（包括大小王）。
FR1.2	系统应将牌随机打乱，并发给4名玩家（1人+3电脑），每人13张，剩余2张弃置不用。
FR1.3	系统应随机决定首位出牌玩家（可为人类或任意电脑）。
FR1.4	游戏初始状态：牌堆为空（累积牌区与最新出牌区均为空），无当前点数，首轮由首位玩家选择点数出牌。
3.2 回合控制
需求编号	需求描述
FR2.1	系统应维护当前轮到哪位玩家行动，并明确标识。
FR2.2	当轮到人类玩家时，界面应激活操作控件（出牌、质疑按钮及点数选择器），并允许点击手牌。
FR2.3	当轮到电脑玩家时，系统应自动调用AI决策模块，执行相应操作（出牌或质疑），并暂停人类操作。
FR2.4	每执行一次操作后，系统应更新牌堆、玩家手牌，并切换到下一玩家。
FR2.5	当某玩家手牌数为0时，游戏立即结束，宣布该玩家获胜。
3.3 出牌操作
需求编号	需求描述
FR3.1	若当前为某轮首次出牌（牌堆为空），出牌玩家必须选择一个点数（A~K），并打出至少1张手牌（可混入万能牌）。打出的牌直接放入最新出牌区。
FR3.2	若非首次出牌（已有当前点数），出牌玩家只能打出至少1张手牌，并宣称其为当前点数（不可更改点数）。打牌前，上一家的出牌（当前最新出牌区）将自动移入累积牌区，然后本次打出的牌放入最新出牌区。
FR3.3	出牌时，玩家从手牌中选中若干张，点击“出牌”按钮完成操作。
FR3.4	出牌后，所选牌从手牌移除，并按上述规则放入相应牌区，同时记录最后出牌玩家、出牌张数及宣称点数。
FR3.5	系统应禁止玩家在不合法情况下出牌（如未选牌、所选牌超出持有数等）。
3.4 质疑操作
需求编号	需求描述
FR4.1	当上一家出牌后（即最新出牌区有牌），当前玩家可选择"质疑"。
FR4.2	点击"质疑"后，系统翻开最新出牌区的所有牌，验证是否全部为宣称点数或万能牌。
FR4.3	若全部为真，质疑失败，质疑者收回整个牌堆（包括累积牌区和最新出牌区的所有牌），最后出牌的玩家获得下一轮的首发出牌权。
FR4.4	若存在假牌，质疑成功，上一家收回整个牌堆（包括累积牌区和最新出牌区的所有牌），质疑者获得下一轮的首发出牌权。
FR4.5	质疑结束后，牌堆清空（累积牌区和最新出牌区均清空），当前点数重置。

3.5 跳过与轮空规则
需求编号	需求描述
FR5.1	当上一家出牌后，当前玩家可选择"跳过"，即不质疑也不跟牌，轮到下一位玩家行动。
FR5.2	若连续所有玩家（包括人类和AI）都选择跳过，则形成"全部跳过"局面。
FR5.3	全部跳过处理：当一轮中除最后出牌者外的其他所有玩家都选择跳过时，最后出牌者自动获得下一轮的首发出牌权。
FR5.4	弃牌规则：全部跳过时，当前牌堆（累积牌区和最新出牌区的所有牌）进入弃牌区，不再属于任何玩家。
FR5.5	弃牌后状态：牌堆清空，当前点数重置，由最后出牌者选择新的点数开始新一轮。
3.6 电脑AI需求
需求编号	需求描述
FR6.1	AI应能根据自身手牌和当前局势决定是否质疑。质疑决策应基于概率模型，考虑上一家出牌数量、自身持有真牌数量等因素。
FR6.2	AI在跟牌时应尽量消耗手牌，优先出真牌（当前点数的普通牌或万能牌），若无真牌则出数量最多的其他点数牌，数量控制在1~2张以降低被质疑风险。
FR6.3	AI获得首发权时，应选择自己手中数量最多的普通点数（不含万能牌）作为新轮点数，并出掉该点数的所有普通牌（可混入万能牌），最多不超过3张。
FR6.4	AI决策过程应有随机性，避免行为完全可预测。
FR6.5	AI操作应在人类可见的延迟（如1秒）后执行，提升交互体验。
FR6.6	AI在决定是否跳过时，应考虑手牌中真牌数量、牌堆大小等因素。若手牌中无真牌且牌堆较大，AI应倾向于跳过而非吹牛。
4. 非功能需求
4.1 性能需求
需求编号	需求描述
NFR1.1	游戏初始化应在2秒内完成。
NFR1.2	玩家点击操作后，界面响应时间不超过0.5秒。
NFR1.3	AI决策时间应控制在1秒以内（不包括延迟）。
4.2 可用性需求
需求编号	需求描述
NFR2.1	界面应简洁清晰，手牌图标易于识别点数和花色。
NFR2.2	当前玩家、当前点数、牌堆张数等关键信息应在显著位置显示。
NFR2.3	所有操作按钮应有明确的标签和状态提示（如禁用原因）。
NFR2.4	游戏过程中应显示简要操作日志，帮助玩家了解历史行动。
4.3 可靠性需求
需求编号	需求描述
NFR3.1	游戏状态应持久保存在内存中，刷新页面将导致重新开始。
NFR3.2	任何非法操作（如未按规则选牌）应被阻止，并给出提示，不影响游戏状态。
4.4 兼容性需求
需求编号	需求描述
NFR4.1	游戏应兼容Chrome、Firefox、Edge、Safari的最新版本。
NFR4.2	界面应适配不同尺寸的桌面显示器，支持最小宽度1024px。
5. 界面需求
5.1 布局设计
顶部区域：显示游戏标题、当前轮次信息（当前点数、牌堆总张数）。

中部区域：显示其他三名电脑玩家的信息（名称、手牌张数、是否当前回合）。

底部区域：显示人类玩家的手牌（可横向滚动或缩小显示），以及操作按钮（出牌、质疑）和点数选择下拉框（仅在需要时出现）。

中央核心区域：显示牌堆，牌堆分为累积牌区和最新出牌区，两者并排放置或上下排列，并配有标签说明。

右侧边栏（可选）：显示操作日志。

5.2 牌堆视觉设计
需求编号	需求描述
UI5.2.1	累积牌区：展示当前轮次中除最新一轮出牌外的所有牌。牌以层叠方式摆放，每张牌只露出顶部约20%的区域（例如左上方区域），形成厚度感。牌叠方向可统一（如向右下偏移）。累积牌区的牌全部背面朝上（因不可见具体牌面）。
UI5.2.2	最新出牌区：展示上一家刚打出的牌（等待被质疑或下一家跟牌）。这些牌同样以层叠方式摆放，每张牌只露出顶部20%，但最上面一张牌可部分显示牌面（如露出点数/花色的一角），以提示玩家最新出牌的情况。也可选择所有牌背面朝上，仅通过标签提示张数，具体由产品设计决定。建议：为了增加策略性，可将最新出牌区的牌全部背面朝上，但显示“最新出牌：X张”的文字信息。
UI5.2.3	两个牌区上方或下方应显示各自包含的牌数（例如“累积：12张”、“最新：3张”）。
UI5.2.4	当累积牌区为空时，显示空白区域或占位符；当最新出牌区为空时，同样显示空白。
UI5.2.5	出牌时，动画效果将新牌从玩家手牌区域飞入最新出牌区；同时，若存在上一家出牌，则上一家的最新出牌区牌叠平滑移动到累积牌区（合并）。质疑时，所有牌从两个牌区飞向收回的玩家手牌区域。
5.3 视觉元素
扑克牌设计：使用矢量或图片表示，正面显示点数与花色，背面统一图案。

选中状态：被选中的手牌应高亮边框或放大。

当前玩家指示：用发光边框或箭头标识。

牌堆：用叠放的扑克图标表示，并显示张数。

5.4 交互细节
鼠标悬停于手牌时，可轻微放大显示。

点击手牌切换选中状态，支持多选。

当轮到人类玩家时，按钮可用；否则禁用并置灰。

电脑行动时，屏幕中央可显示“电脑X正在思考...”提示。

悬停在最新出牌区时，可弹出提示框显示该轮出牌的具体信息（如“电脑2宣称出了3张A”），方便玩家回忆。

6. AI策略详细设计
6.1 质疑策略
AI计算：

myNormal = 自己手中当前点数的普通牌数量

myJoker = 自己手中万能牌数量

maxTrueOutside = (4 - myNormal) + (2 - myJoker) // 外部最多真牌+万能牌
若上家出牌张数 n > maxTrueOutside，则必定质疑。
否则，质疑概率 P 计算如下：

若 n >= 3 且 myNormal >= 2，P = 0.7

若 n == 2，P = 0.3

若 n == 1，P = 0.1

若 n == 0（不可能，但保留）

若手牌数量 ≤ 2，P = P * 0.5（谨慎）

6.2 跟牌策略
AI按优先级选择出牌组合：

若存在当前点数的普通牌或万能牌，出所有真牌（最多3张，以免过度暴露）。若真牌数量为0，转2。

选择手牌中数量最多的其他点数（如手中有3张K），出1~2张该点数的牌。

若无重复点数，随机选1~2张牌（非万能牌，除非只有万能牌）。

若手牌全为万能牌，出1张万能牌。

6.3 首发策略
AI遍历自己所有普通牌的点数，找出出现次数最多的点数（若并列随机选一个）。然后：

打出该点数的所有普通牌（数量记为cnt），若cnt > 3，只出3张。

若需要凑整，可加入万能牌，但万能牌数量不超过普通牌数量。
若没有普通牌（全是万能牌），则随机选一个点数（如A），出1张万能牌。

6.4 随机性实现
在每个决策点，生成随机数与概率阈值比较，决定是否执行特定行动。例如，质疑时生成0~1随机数，若小于P则质疑。

7. 验收标准
初始化：游戏开始后，四名玩家各获得13张牌，界面显示正确，首位玩家随机。

人类出牌：

新轮时，未选点数时出牌按钮禁用；选点数并选牌后可用。

跟牌时，点数自动锁定，出牌按钮随选牌启用。

非法选牌（如选中超出）给出提示。

人类质疑：上一家出牌后，质疑按钮可用；点击后正确验证并执行收牌逻辑。

牌堆显示：

首次出牌后，最新出牌区显示刚打出的牌（层叠样式），累积牌区为空。

第二次出牌后，上一家的牌移入累积牌区，最新出牌区显示新牌。

质疑后，两区清空。

牌叠只显示顶部20%，视觉上符合层叠效果。

AI行动：AI在轮到其回合时自动操作，操作延迟1秒，质疑/出牌符合策略。

全部跳过：当所有其他玩家都选择跳过时，最后出牌者获得下一轮出牌权，牌堆进入弃牌区。

游戏结束：当任意玩家手牌为0时，弹出获胜者提示，不再允许操作。

状态持久：刷新页面后游戏重置。

兼容性：在指定浏览器上打开，布局正常，功能可用。

8. 附录
8.1 点数顺序
A, 2, 3, 4, 5, 6, 7, 8, 9, 10, J, Q, K （无大小顺序，仅用于标识）

8.2 万能牌处理
大小王在验证时视为任何点数，但在跟牌时AI可将其当作真牌使用。