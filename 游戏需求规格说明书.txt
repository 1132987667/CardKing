游戏需求规格说明书（更新版）
1. 引言
1.1 编写目的
本文档旨在明确描述一款融合了“比大小”、“24点”和“炸金花”三种玩法的复合扑克牌游戏的需求。游戏为单机人机对战模式，支持1名人类玩家与1~3名电脑玩家同台竞技。文档详细规定了游戏规则、交互方式、计分逻辑、系统行为及AI设计，为开发、测试和验收提供依据。

1.2 适用范围
本文档适用于游戏开发团队、测试人员及项目管理人员。

1.3 定义与缩略语
术语	解释
一局游戏	由多轮比赛组成，所有轮次结束后根据总分决出胜者。
一轮游戏	每轮中每位玩家获得12张牌，并分为上下两个回合进行出牌和计分。
回合	每回合玩家从手中6张牌中分成三堆（1张、2张、3张），分别参与三种比试。
比大小堆	第一堆，每人出一张牌，按点数大小比较，点数相同则比花色。
24点堆	第二堆，每人出两张牌，计算点数之和，比较与24的关系及最大牌。
炸金花堆	第三堆，每人出三张牌，按炸金花牌型规则比较。
豹子	三张点数相同的牌。
顺金	同花顺，即花色相同且点数连续。
金花	同花，即花色相同但点数不连续。
顺子	点数连续但花色不全相同。
对子	两张点数相同，另一张不同。
单张	三张牌无特殊组合。
底分	每堆比赛的名次对应得分，第一名得（玩家人数-1）分，第二名得（玩家人数-2）分，依此类推，最后一名得0分。炸金花堆得分翻倍。
AI	人工智能，电脑玩家。
2. 总体描述
2.1 产品视角
本产品是一款创新型扑克牌游戏，将三种经典玩法融合于同一轮次中，考验玩家的策略分配能力。玩家需将手中12张牌合理分配到两个回合的三个堆中，争取在每个小项中获得高分。游戏提供直观的图形界面，支持鼠标拖拽出牌，电脑玩家采用基于枚举优化的智能策略进行自动分配。

2.2 用户特征
主要用户：喜欢棋牌类游戏的玩家，对策略组合感兴趣。

次要用户：希望通过人机对战熟悉炸金花、24点等规则的初学者。

用户需具备基本的扑克牌认知，无需专业数学知识。

2.3 假设与依赖
游戏使用一副标准54张扑克牌（含大小王），但大小王在发牌时被剔除，实际有效牌为52张（无大小王）。

图形界面需支持拖拽操作，若采用控制台版本则需提供数字选择方式。



3. 具体需求
3.1 游戏初始化
功能编号	FR-001
名称	开始新游戏
描述	玩家启动游戏后，可设置电脑玩家数量（1~3）和一轮游戏包含的轮次数（3~7）。
输入	通过界面滑动条或下拉框选择电脑人数和轮数。
处理	系统创建指定数量的AI玩家和一个人类玩家，每位玩家初始总分为0。
输出	进入牌桌界面，显示所有玩家信息（玩家1、电脑2等）及当前轮次/回合提示。
3.2 发牌规则
功能编号	FR-002
名称	每轮发牌
描述	每轮开始时，系统从洗好的牌堆中为每位玩家发放12张有效牌。
处理	1. 使用一副54张牌（含大小王），洗牌。
2. 依次为每位玩家发牌，每次发一张。若发到大小王，则将该牌丢弃（不发给任何玩家），并继续从牌堆中发下一张，直至每位玩家拥有12张非大小王的牌。
3. 发牌过程中丢弃的大小王不再使用，且不计入任何玩家手中。
4. 发完12张后，剩余牌弃用（不进入后续轮次）。
输出	每位玩家获得12张手牌，在界面中以背面或正面显示（玩家可见自己的牌，AI的牌对玩家保密）。
3.3 回合流程
每轮包含两个回合：上半回合和下半回合。每个回合玩家需从当前手牌中选出6张牌，并分成三堆（分别用于比大小、24点、炸金花），然后同时亮牌比较计分。

3.3.1 上半回合出牌
功能编号	FR-003
名称	上半回合出牌
描述	玩家从12张手牌中选出6张，并分配至三个堆，剩余6张留待下半回合使用。
操作方式	人类玩家通过鼠标拖拽牌张到指定区域（第一堆区域、第二堆区域、第三堆区域），每堆需放满指定张数（1、2、3）后才可确认。AI玩家由系统自动分配。
约束	每堆牌必须恰好为指定张数，且每张牌只能使用一次。玩家可随时调整分配，确认后进入等待状态。
确认机制	所有玩家完成分配后，系统自动进入亮牌比较阶段。若某玩家未确认，系统可设置超时机制（如30秒未操作则随机分配）。
3.3.2 亮牌与比较
功能编号	FR-004
名称	三堆同时比较
描述	所有玩家确认出牌后，系统同时显示每堆的牌，并按规则计算每堆的名次和得分。
处理	1. 先分别计算每堆的排名（第一名、第二名……最后一名）。
2. 根据排名计算每堆得分：第一名得（玩家数-1）分，第二名得（玩家数-2）分，……最后一名得0分。炸金花堆得分乘以2。
3. 将三堆得分累加，计入每位玩家的本回合得分，并累加到总分。
输出	界面展示各玩家每堆的牌、每堆排名及得分，并更新总分。
3.3.3 下半回合出牌
功能编号	FR-005
名称	下半回合出牌
描述	使用上半回合剩余的6张牌，重复出牌、比较、计分过程。
处理	同上半回合，玩家需将剩余6张牌重新分配至三堆。
3.3.4 轮次结束
功能编号	FR-006
名称	轮次结算
描述	两个回合结束后，本轮完成。显示本轮各玩家总分，并准备进入下一轮。
处理	若已完成预设轮次数，则跳转到游戏结束结算；否则重新洗牌，开始新一轮发牌。
3.4 各堆详细比较规则
3.4.1 比大小堆（1张牌）
点数顺序：A > K > Q > J > 10 > 9 > 8 > 7 > 6 > 5 > 4 > 3 > 2（A最大，2最小）。

花色顺序：黑桃 > 红心 > 梅花 > 方块。

比较方法：先比点数，点数大者胜；若点数相同，则比花色，花色大者胜。

排名：按上述规则从大到小排序，确定唯一第一名、第二名等（由于点数花色组合唯一，不会出现平局）。

3.4.2 24点堆（2张牌）
牌面点数：A=1，K=13，Q=12，J=11，10=10，…，2=2。大小王不出现。

计算规则：计算两张牌的点数之和（记为S）。

比较步骤：

若S > 24，则该玩家得分为0，且排名在所有S≤24的玩家之后。
若S ≤ 24，则比较S的大小，S越大者排名越靠前。
若S相同，则比较这两张牌中最大的那张牌的点数，点数大者排名靠前。
若最大牌点数也相同，则比较该最大牌的花色（花色大者胜）。
注意：由于每张牌点数花色唯一，上述比较可保证排名唯一。

3.4.3 炸金花堆（3张牌）
牌型大小顺序（从大到小）：
豹子 > 顺金 > 金花 > 顺子 > 对子 > 单张

牌型定义：

豹子：三张点数相同。

顺金：花色相同且点数连续（A可作为最大或最小，但必须连续，如A、2、3或Q、K、A）。

金花：花色相同但点数不连续。

顺子：点数连续但花色不全相同。

对子：两张点数相同，另一张不同。

单张：三张牌无上述组合。

同牌型比较规则：

豹子：比较点数，点数大者胜。

顺金/顺子：比较最大牌的点数，若相同则比较次大牌的点数，若还相同则比较最小牌的点数。若所有点数相同，则比较最大牌的花色。

金花/单张：按点数从大到小排序，先比较最大牌点数，若相同则比较次大牌，再相同则比较最小牌。若所有点数相同，则比较最大牌的花色。

对子：先比较对子的点数，大者胜；若相同则比较单张的点数；若单张也相同，则比较对子中最大花色（即对子中花色较大的那张），若还相同则比较单张的花色。

排名：上述规则保证唯一排名，不会出现平局。

3.5 计分规则
每堆比赛，根据排名获得分数：
第1名：得（玩家总数 - 1）分
第2名：得（玩家总数 - 2）分
...
最后一名：得0分
例如，4人游戏，第一名得3分，第二名得2分，第三名得1分，第四名得0分。

炸金花堆的得分在上述基础上乘以2。即第一名得2*(n-1)分，第二名得2*(n-2)分，以此类推。

每回合结束后，将三堆得分相加，得到该回合得分，并累加到玩家总分。

一轮结束后，显示本轮各玩家总分，然后进入下一轮。

3.6 游戏结束与胜负判定
完成预设轮次数（3~7轮）后，游戏结束。

比较所有玩家的累计总分，总分最高者获胜。若出现同分，则并列第一（显示并列冠军）。

3.7 AI设计
3.7.1 设计目标
AI玩家需具备一定的出牌智能，能够根据当前手牌合理分配至三个堆，以争取本回合最高得分。AI不依赖对其他玩家手牌的预测，仅基于自身手牌的绝对强度进行优化。

3.7.2 牌力评估函数
为量化每堆牌的强度，定义以下评估函数（分数越高表示该堆在比较中越强）：

比大小堆强度 score_single(card)：
score = 点数 * 10 + 花色值，其中花色值：黑桃=4，红心=3，梅花=2，方块=1；点数：A=14，K=13，Q=12，J=11，10=10，...，2=2。

24点堆强度 score_24(card1, card2)：
计算点数和S。若S > 24，则强度 = 0；否则强度 = S * 100 + 最大牌点数 * 10 + 最大牌花色值（最大牌点数若相同，取花色值大的那张）。

炸金花堆强度 score_poker(card1, card2, card3)：
根据游戏比较规则，构造一个整数分数，使得分数大小与牌型强弱完全一致。构造方法如下：

确定牌型等级：豹子=6，顺金=5，金花=4，顺子=3，对子=2，单张=1。
对三张牌按比较规则提取关键特征，生成分数：
豹子：等级*1000000 + 点数*1000 + 最大花色
顺金/顺子：将三张牌按点数从大到小排序（注意顺子中A可能为1，但排序时按实际比较值，例如A23顺子排序后为3,2,1），分数 = 等级*1000000 + 最大牌点数*10000 + 次大牌点数*100 + 最小牌点数*1 + 最大牌花色
金花/单张：排序后，分数 = 等级*1000000 + 点数1*10000 + 点数2*100 + 点数3*1 + 最大牌花色
对子：设对子点数为P，单张点数为S，排序时P可能大于或小于S，但分数构造为：等级*1000000 + P*10000 + S*100 + 对子中较大花色*10 + 单张花色（保证比较顺序）
该函数确保任何两手牌，若甲大于乙，则score_poker(甲) > score_poker(乙)。
3.7.3 回合内最优分配算法
在每一回合开始时，AI手中有固定张数的牌（上半回合12张，下半回合6张）。AI通过枚举所有可能的分配方案，选择使目标函数最大化的方案。

目标函数：
total = score_single(比大小牌) + score_24(24点牌1, 24点牌2) + 2 * score_poker(炸金花牌1, 炸金花牌2, 炸金花牌3)

枚举步骤：

从当前手牌中选出6张牌的所有组合（上半回合C(12,6)，下半回合仅1种）。
对每个6张牌组合，枚举所有分配方式：
从6张中选1张给比大小堆：C(6,1)
从剩余5张中选2张给24点堆：C(5,2)
剩余3张给炸金花堆
共 6 * 10 = 60 种分配。
计算每种分配的total值，记录最大值对应的分配方案。
若多个方案并列最大，随机选择其一。
输出：该回合的6张牌及其归属（三堆的具体牌张）。

3.7.4 上下半回合的协同
上半回合：AI从12张牌中按上述算法选出最优的6张及分配，剩余6张自动进入下半回合。

下半回合：AI将剩余6张牌作为手牌，再次调用上述算法（此时6张牌的组合唯一，只需枚举60种分配），选出最优分配。

3.7.5 性能要求
AI决策时间 ≤ 1秒，确保游戏流畅。

枚举算法在Python中实现应满足性能要求，必要时可预先计算牌力值或采用缓存优化。

3.8 用户界面
主界面：开始游戏设置（电脑人数、轮数）、帮助、退出。

牌桌界面：

显示所有玩家的头像、名称、当前总分。

中央显示当前回合及倒计时（可选）。

人类玩家手牌区域，牌面朝上，可拖拽。

三个目标区域（比大小堆、24点堆、炸金花堆），每个区域有对应图标和数字（1、2、3）提示张数。

确认按钮：玩家完成分配后点击确认。

电脑玩家的牌背面朝上，但出牌后亮牌时显示正面。

亮牌阶段，展示所有玩家各堆的牌，并显示排名和得分。

下一回合/下一轮按钮（自动跳转）。

操作方式：鼠标拖拽牌张到目标区域，也可双击自动放置。支持撤销。

3.9 异常处理
玩家超时未确认：系统自动为玩家随机分配剩余牌，并提示。

发牌时若因大小王丢弃导致有效牌不足，重新洗牌并提示（概率极低）。

4. 非功能需求
4.1 性能
游戏启动时间 ≤ 3秒。

每回合操作响应时间 ≤ 0.5秒。

AI决策时间 ≤ 1秒（单AI）。

4.2 可用性
界面简洁，操作直观，新手可在10分钟内掌握。

提供规则说明帮助文档。

支持键盘快捷键（如回车确认、ESC退出等）。