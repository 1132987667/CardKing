1. 项目概述
项目名称：card-king（中文名：三卡对决）
引擎：Godot 4.x（GDScript）
平台：Windows / macOS / Linux（优先桌面），可扩展至 HTML5
游戏类型：2D 单人扑克策略游戏，玩家与电脑对手进行多轮对决
2. 游戏目标
在可配置的轮次（默认5轮）结束后，累计积分最高的玩家获胜。
玩家需通过合理分配手牌，在三种扑克小游戏（单张比大小、24点和、比三张）的每个小组中争取更高名次，从而最大化总分。
3. 玩家配置
人类玩家：1名
电脑对手数量：可配置 1~3 名，即总玩家数可为 2~4 人
每轮每位玩家获得 12 张手牌（从一副去掉大小王的 52 张扑克中抽取）
4. 游戏流程（每轮）
4.1 发牌
牌堆：一副标准扑克（52张，无大小王）
每轮开始前彻底洗牌
根据当前玩家总数 N，为每位玩家发放 12 张牌。剩余牌（52 - N×12）本轮弃用
4.2 分组阶段
每位玩家需将 12 张牌分成 两份（每份 6 张），每份内部分为三个小组：
1张牌组（单张组）
2张牌组（24点组）
3张牌组（比三张组）
每位玩家共形成 6 个小组，各小组牌数固定，不可更改
分组要求：
每个小组的牌数必须严格符合规定（1、2、3张）
所有手牌必须用完，不得剩余
小组之间牌不可重复
4.3 比较阶段
所有玩家完成分组后，同时亮出各组的牌
对 每一个小组（共6组）独立进行以下比较：
① 单张组
按扑克点数大小排序，从大到小：A > K > Q > J > 10 > 9 > … > 2
点数相同则比较花色，花色大小为: 黑桃 > 红桃 > 梅花 > 方片
② 24点组
按两张牌的点数之和排序，小于等于24点时，和越大排名越高
点数相同，则先比较点数最大的牌的点数，若仍相同则比较点数最大的牌的花色，花色大小为: 黑桃 > 红桃 > 梅花 > 方片
③ 比三张组
按标准比三张牌型大小排序，优先级为：
豹子（三张同点）
同花顺（同花且顺子）
同花（三张同花色）
顺子（点数连续，A可作为1或14，但不可循环，如QKA、A23合法）
对子（两张同点）
散牌（高牌）
若牌型相同，则依次比较单张点数（从大到小）；若仍相同，则比较花色，花色大小为: 黑桃 > 红桃 > 梅花 > 方片
4.4 计分规则
设有 P 名玩家（P = 2,3,4）
每组根据排名分配积分：
第一名获得 P-1 分
第二名获得 P-2 分
……
最后一名 0 分
比三张组 的得分 翻倍（即第一名得 2×(P-1) 分，第二名得 2×(P-2) 分，以此类推）
每组独立计分，立即累加到玩家的 累计总分 中
4.5 轮次循环
完成一轮所有 6 组的比较与计分后，若已进行轮数达到设定值，则游戏结束，显示最终排名；否则进入下一轮（重新洗牌、发牌、分组）
5. 游戏配置（主菜单）
电脑玩家数量：滑动条或下拉框，可选 1、2、3
游戏轮数：滑动条或输入框，范围 1~10，默认 5
“开始游戏”按钮：点击后进入游戏主场景，并应用上述配置
“退出”按钮：退出游戏
6. 用户界面需求
6.1 主菜单
简洁背景，显示游戏标题
配置项区域
开始游戏 / 退出按钮
6.2 游戏主界面
顶部状态栏：显示当前轮次/总轮数，玩家当前总分
玩家手牌区：横向展示 12 张牌（牌面朝上），每张牌可点击或拖拽
分组区：展示 6 个小组槽位，每个槽位标明组类型（单张、24点、比三张）及所属份数（第一份/第二份），槽位内显示已放入的牌的小图标或文字
操作按钮：
“自动分组”：随机将手牌填入所有槽位（用于快速测试或辅助）
“确认分组”：当所有槽位均填满且符合牌数要求时可用，点击后提交玩家分组
电脑状态区：显示每位电脑的头像和当前状态（如“思考中…”或“已准备”）
6.3 结果展示
比较阶段：可以用动画或高亮显示每组胜者
本轮结束后弹出简要报告，列出各组获胜者及得分
游戏结束时显示最终积分榜，并高亮胜利者
7. 人工智能（AI）需求
电脑对手需具备自动分组能力
基础版本：随机分组（将手牌随机排序后按顺序填入各组）
进阶版本（可选）：基于简单策略，例如：
单张组尽量留大牌
24点组尽量选点数大的两张
比三张组尝试凑成同花或顺子等大牌型
AI 决策应在玩家分组期间同步完成，避免明显等待
8. 技术需求
引擎：Godot 4.x
语言：GDScript
分辨率：适配 1280×720 及以上
资源：扑克牌图片，字体、音效可选
9. 非功能需求
可维护性：代码模块化，核心规则（比较、计分）独立为工具类，便于修改
可配置性：游戏轮数、电脑人数可通过全局变量传递
用户体验：操作流畅，反馈清晰，无明显卡顿

二、开发规范
1. 注释规范
所有注释均使用中文
生成的函数、接口、类等均需添加中文注释，包括：
功能描述
参数说明（名称、类型、作用）
返回值说明（类型、含义）
可能抛出的异常或需要注意的事项
复杂逻辑处应添加行内注释，解释算法思路或关键步骤
2. 编码原则
准确理解与执行：开发前需充分理解需求，如有歧义及时与需求方确认；严格执行已确定的功能要求，不擅自添加、删除或修改功能
模块化设计：将系统划分为独立模块（如牌堆、玩家、AI、规则评估、UI控制器等），降低耦合，提高可复用性
优先复用现有模块：在进行新功能开发或问题解决时，应先梳理系统现有功能模块清单，评估能否复用或扩展现有模块，避免重复开发
修改代码时全面检查：修改一处代码时，必须查看关联上下游文件，确保修改不会引入新问题或破坏系统稳定性
单元测试：关键逻辑（如牌型比较、计分规则）应编写测试脚本，确保正确性
3. 命名规范
节点路径：使用英文小写加下划线，如 player_hand_container
脚本文件名：使用大驼峰（PascalCase），如 Game.gd, RuleEvaluator.gd
类名：与文件名一致，大驼峰
变量/函数名：使用小驼峰（camelCase），如 currentRound, calculateScore()
常量：使用全大写加下划线，如 MAX_PLAYERS

# 特别备注
不需要启动